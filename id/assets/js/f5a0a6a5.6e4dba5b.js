"use strict";(self.webpackChunklunox=self.webpackChunklunox||[]).push([[3579],{9613:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(9496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,g=c["".concat(l,".").concat(m)]||c[m]||p[m]||i;return n?a.createElement(g,o(o({ref:t},d),{},{components:n})):a.createElement(g,o({ref:t},d))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2746:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(1163),r=(n(9496),n(9613));const i={sidebar_position:1},o="Getting Started",s={unversionedId:"database/getting-started",id:"version-1.x/database/getting-started",title:"Getting Started",description:"Introduction",source:"@site/versioned_docs/version-1.x/database/getting-started.md",sourceDirName:"database",slug:"/database/getting-started",permalink:"/id/docs/1.x/database/getting-started",draft:!1,editUrl:"https://github.com/kodepandai/lunox-website/edit/main/versioned_docs/version-1.x/database/getting-started.md",tags:[],version:"1.x",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Artisan Console",permalink:"/id/docs/1.x/digging-deeper/artisan-console"},next:{title:"Query Builder",permalink:"/id/docs/1.x/database/query-builder"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Running SQL Queries",id:"running-sql-queries",level:2},{value:"Running A Select Query",id:"running-a-select-query",level:3},{value:"Basic Select Query",id:"basic-select-query",level:4},{value:"Select With Condition",id:"select-with-condition",level:4},{value:"Return First Row of Selected Data",id:"return-first-row-of-selected-data",level:4},{value:"Running An Insert Statement",id:"running-an-insert-statement",level:3},{value:"Running An Update Statement",id:"running-an-update-statement",level:3},{value:"Running A Delete Statement",id:"running-a-delete-statement",level:3},{value:"Database Transaction",id:"database-transaction",level:2},{value:"As A Query Builder",id:"as-a-query-builder",level:3},{value:"As An Object Passed Into A Query",id:"as-an-object-passed-into-a-query",level:3}],d={toc:u},c="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"getting-started"},"Getting Started"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"You can use any third party database manager, but lunox already shipped builtin database manager. Lunox makes interacting with database simple. Under the hood, lunox database manager is using ",(0,r.kt)("a",{parentName:"p",href:"http://knexjs.org/"},"knex"),", so you can read the official documentation for complete knex's API reference. Lunox wrap ",(0,r.kt)("inlineCode",{parentName:"p"},"knex")," into ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade. We also integrate it to artisan command. So we can create migration, seeder, run and rollback migration using artisan command. We will discuss it later."),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The configuration for Lunox's database services is located in your application's ",(0,r.kt)("inlineCode",{parentName:"p"},"config/database.ts")," configuraiton file. In this file, you may define all of your database connections, as well as specify which connection should be used by default. Most of the configuration options within this file are driven by the values of your application's environment variables. Examples for most of Lunox's supported database systems are provided in this file."),(0,r.kt)("p",null,"For now Lunox only support these drivers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mysql")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"mariadb"),", please install ",(0,r.kt)("inlineCode",{parentName:"li"},"mysql")," as dependency."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"postgresql"),", please install ",(0,r.kt)("inlineCode",{parentName:"li"},"pg")," as dependency."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sqlite"),", please install ",(0,r.kt)("inlineCode",{parentName:"li"},"sqlite3")," as dependency.")),(0,r.kt)("h2",{id:"running-sql-queries"},"Running SQL Queries"),(0,r.kt)("p",null,"Once you have configured your database connection, you may run queries using the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade. The ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade provides ",(0,r.kt)("inlineCode",{parentName:"p"},"table")," method to initialize query. "),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Note that all query running asyncronously.")),(0,r.kt)("h3",{id:"running-a-select-query"},"Running A Select Query"),(0,r.kt)("h4",{id:"basic-select-query"},"Basic Select Query"),(0,r.kt)("p",null,"To run a basic ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," query, you may use the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," method on the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {DB} from \"lunox\";\n\n// select all row from table `users`.\nawait DB.table('users');\n\n// select only some columns.\nawait DB.table('users').select('id', 'email', 'user_name');\n")),(0,r.kt)("h4",{id:"select-with-condition"},"Select With Condition"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," method to add ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE")," clause in query."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await DB.table('users').where('email', 'foo@example.com');\n\n// multiple condition using object\nawait DB.table('users').where({\n email: 'foo@example.com',\n active: 1\n})\n\n// chainable where\nawait DB.table('users')\n  .where('email', 'foo@example.com')\n  .where('active', 1)\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"note"),": for complete guide about where clause, see ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/query-builder.html#where-clauses"},"knex`s where clauses")," documentation.")),(0,r.kt)("h4",{id:"return-first-row-of-selected-data"},"Return First Row of Selected Data"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"first")," method to return only first row."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await DB.table('users').where('email', 'foo@example.com').first();\n")),(0,r.kt)("h3",{id:"running-an-insert-statement"},"Running An Insert Statement"),(0,r.kt)("p",null,"To execute an insert statement, you may use the ",(0,r.kt)("inlineCode",{parentName:"p"},"insert")," method on the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"\n// insert into table users\nawait DB.table('users').insert({\n  email: 'foo@example.com',\n  user_name: 'exampleuser',\n  first_name: 'foo',\n  last_name: 'bar'\n});\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"note"),": for complete guide about insert statement, please read ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/query-builder.html#insert"},"knex`s insert documentation"))),(0,r.kt)("h3",{id:"running-an-update-statement"},"Running An Update Statement"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"update")," method should be used to update existing records in the database."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await DB.table('users')\n  .where('id', 24)\n  .update('active', 0);\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"note"),": for complete guide about update statement, please read ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/query-builder.html#update"},"knex`s update documentation"))),(0,r.kt)("h3",{id:"running-a-delete-statement"},"Running A Delete Statement"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"delete")," method should be used to delete records from the database."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await DB.table('users')\n  .where('active', 0)\n  .delete();\n")),(0,r.kt)("h2",{id:"database-transaction"},"Database Transaction"),(0,r.kt)("p",null,"You may use the ",(0,r.kt)("inlineCode",{parentName:"p"},"transaction")," method provided by the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade to run a set of operations within a database transaction. If an exception is thrown within the transaction closure, the transaction will automatically be rolled back and the exception is re-thrown. If the closure executes successfully, the transaction will automatically be committed. You don't need to worry about manually rolling back or committing while using the ",(0,r.kt)("inlineCode",{parentName:"p"},"transaction")," method."),(0,r.kt)("p",null,"Transactions are handled by passing a handler function into ",(0,r.kt)("inlineCode",{parentName:"p"},"DB.transaction"),". The handler function accepts a single argument, an object which may be used in two ways:"),(0,r.kt)("h3",{id:"as-a-query-builder"},"As A Query Builder"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"try {\n await DB.transaction(async(trx)=>{\n   // using trx as query builder\n   const userIds = await trx('users').insert({\n    email: 'foo@mail.com'\n   })\n \n   await trx('books').insert({\n    user_id: userIds[0],\n    name: 'Lunox Documentation'\n   });\n })\n} catch(error){\n  // If we get here, that means that neither the 'user' and 'book' are inserted,\n  console.log(error)\n  abort(400, 'cannot insert to database');\n}\n")),(0,r.kt)("h3",{id:"as-an-object-passed-into-a-query"},"As An Object Passed Into A Query"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"try {\n await DB.transaction(async(trx)=>{\n   // using trx as query builder\n   const userIds = await DB.table('users').insert({\n    email: 'foo@mail.com'\n   })\n   .transacting(trx)\n \n   await DB.table('books').insert({\n    user_id: userIds[0],\n    name: 'Lunox Documentation'\n   })\n   .transacting(trx)\n })\n} catch(error){\n  // If we get here, that means that neither the 'user' and 'book' are inserted,\n  console.log(error)\n  abort(400, 'cannot insert to database');\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"note"),": please read ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/transactions.html"},"knex's transaction documentation")," for more detail")))}p.isMDXComponent=!0}}]);