"use strict";(self.webpackChunklunox=self.webpackChunklunox||[]).push([[5145],{9613:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(9496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||p[m]||i;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3851:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(1163),r=(n(9496),n(9613));const i={sidebar_position:1},o="Getting Started",s={unversionedId:"database/getting-started",id:"database/getting-started",title:"Getting Started",description:"Introduction",source:"@site/docs/database/getting-started.md",sourceDirName:"database",slug:"/database/getting-started",permalink:"/docs/database/getting-started",draft:!1,editUrl:"https://github.com/kodepandai/lunox-website/edit/main/docs/database/getting-started.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Artisan Console",permalink:"/docs/digging-deeper/artisan-console"},next:{title:"Query Builder",permalink:"/docs/database/query-builder"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Running SQL Queries",id:"running-sql-queries",level:2},{value:"Running a Select Query",id:"running-a-select-query",level:3},{value:"Basic Select Query",id:"basic-select-query",level:4},{value:"Select with Condition",id:"select-with-condition",level:4},{value:"Return the First Row of Selected Data",id:"return-the-first-row-of-selected-data",level:4},{value:"Running an Insert Statement",id:"running-an-insert-statement",level:3},{value:"Running an Update Statement",id:"running-an-update-statement",level:3},{value:"Running a Delete Statement",id:"running-a-delete-statement",level:3},{value:"Database Transaction",id:"database-transaction",level:2},{value:"As a Query Builder",id:"as-a-query-builder",level:3},{value:"As an Object Passed into a Query",id:"as-an-object-passed-into-a-query",level:3}],d={toc:u},c="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"getting-started"},"Getting Started"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"You can use any third-party database manager, but Lunox already ships with a built-in database manager. Lunox makes interacting with the database simple. Under the hood, Lunox's database manager uses ",(0,r.kt)("a",{parentName:"p",href:"http://knexjs.org/"},"knex"),", so you can refer to the official documentation for a complete Knex API reference. Lunox wraps ",(0,r.kt)("inlineCode",{parentName:"p"},"knex")," into the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade. We have also integrated it with the Artisan command, so you can create migrations, seeders, and run/rollback migrations using the Artisan command. We will discuss this later."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"To use the database, you need to install ",(0,r.kt)("inlineCode",{parentName:"p"},"@lunoxjs/eloquent")," and register the ",(0,r.kt)("inlineCode",{parentName:"p"},"DatabaseServiceProvider")," in your ",(0,r.kt)("inlineCode",{parentName:"p"},"config/app.ts")," file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pnpm add @lunoxjs/eloquent\n")),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The configuration for Lunox's database services is located in your application's ",(0,r.kt)("inlineCode",{parentName:"p"},"config/database.ts")," configuration file. In this file, you can define all of your database connections and specify which connection should be used by default. Most of the configuration options within this file are driven by the values of your application's environment variables. Examples for most of Lunox's supported database systems are provided in this file."),(0,r.kt)("p",null,"Currently, Lunox only supports the following drivers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mysql")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"mariadb"),". Please install ",(0,r.kt)("inlineCode",{parentName:"li"},"mysql")," as a dependency."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"postgresql"),". Please install ",(0,r.kt)("inlineCode",{parentName:"li"},"pg")," as a dependency."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sqlite"),". Please install ",(0,r.kt)("inlineCode",{parentName:"li"},"sqlite3")," as a dependency.")),(0,r.kt)("h2",{id:"running-sql-queries"},"Running SQL Queries"),(0,r.kt)("p",null,"Once you have configured your database connection, you can run queries using the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade. The ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade provides the ",(0,r.kt)("inlineCode",{parentName:"p"},"table")," method to initialize a query."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Note that all queries run asynchronously.")),(0,r.kt)("h3",{id:"running-a-select-query"},"Running a Select Query"),(0,r.kt)("h4",{id:"basic-select-query"},"Basic Select Query"),(0,r.kt)("p",null,"To run a basic ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," query, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," method on the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { DB } from "@lunoxjs/eloquent";\n\n// Select all rows from the `users` table.\nawait DB.table("users");\n\n// Select only specific columns.\nawait DB.table("users").select("id", "email", "user_name");\n')),(0,r.kt)("h4",{id:"select-with-condition"},"Select with Condition"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," method to add a ",(0,r.kt)("inlineCode",{parentName:"p"},"WHERE")," clause to the query."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'await DB.table("users").where("email", "foo@example.com");\n\n// Multiple conditions using an object.\nawait DB.table("users").where({\n  email: "foo@example.com",\n  active: 1,\n});\n\n// Chainable where.\nawait DB.table("users").where("email", "foo@example.com").where("active", 1);\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": For a complete guide on using the ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," clause, see the ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/query-builder.html#where-clauses"},"Knex's where clauses")," documentation.")),(0,r.kt)("h4",{id:"return-the-first-row-of-selected-data"},"Return the First Row of Selected Data"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"first")," method to return only the first row."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'await DB.table("users").where("email", "foo@example.com").first();\n')),(0,r.kt)("h3",{id:"running-an-insert-statement"},"Running an Insert Statement"),(0,r.kt)("p",null,"To execute an insert statement, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"insert")," method on the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// Insert into the `users` table.\nawait DB.table("users").insert({\n  email: "foo@example.com",\n  user_name: "exampleuser",\n  first_name: "foo",\n  last_name: "bar",\n});\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": For a complete guide on the insert statement, please read the ","[Knex's insert documentation]","(",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide"},"https://knexjs.org/guide"))),(0,r.kt)("p",null,"/query-builder.html#insert)."),(0,r.kt)("h3",{id:"running-an-update-statement"},"Running an Update Statement"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"update")," method should be used to update existing records in the database."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'await DB.table("users").where("id", 24).update("active", 0);\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": For a complete guide on the update statement, please read the ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/query-builder.html#update"},"Knex's update documentation"),".")),(0,r.kt)("h3",{id:"running-a-delete-statement"},"Running a Delete Statement"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"delete")," method should be used to delete records from the database."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'await DB.table("users").where("active", 0).delete();\n')),(0,r.kt)("h2",{id:"database-transaction"},"Database Transaction"),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"transaction")," method provided by the ",(0,r.kt)("inlineCode",{parentName:"p"},"DB")," facade to run a set of operations within a database transaction. If an exception is thrown within the transaction closure, the transaction will automatically be rolled back and the exception will be re-thrown. If the closure executes successfully, the transaction will automatically be committed. You don't need to worry about manually rolling back or committing when using the ",(0,r.kt)("inlineCode",{parentName:"p"},"transaction")," method."),(0,r.kt)("p",null,"Transactions are handled by passing a handler function into ",(0,r.kt)("inlineCode",{parentName:"p"},"DB.transaction"),". The handler function accepts a single argument, an object that can be used in two ways:"),(0,r.kt)("h3",{id:"as-a-query-builder"},"As a Query Builder"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'try {\n  await DB.transaction(async (trx) => {\n    // Using `trx` as a query builder.\n    const userIds = await trx("users").insert({\n      email: "foo@mail.com",\n    });\n\n    await trx("books").insert({\n      user_id: userIds[0],\n      name: "Lunox Documentation",\n    });\n  });\n} catch (error) {\n  // If we get here, it means that neither the \'user\' nor the \'book\' are inserted.\n  console.log(error);\n  abort(400, "cannot insert into the database");\n}\n')),(0,r.kt)("h3",{id:"as-an-object-passed-into-a-query"},"As an Object Passed into a Query"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'try {\n  await DB.transaction(async (trx) => {\n    // Using `trx` as a query builder.\n    const userIds = await DB.table("users")\n      .insert({\n        email: "foo@mail.com",\n      })\n      .transacting(trx);\n\n    await DB.table("books")\n      .insert({\n        user_id: userIds[0],\n        name: "Lunox Documentation",\n      })\n      .transacting(trx);\n  });\n} catch (error) {\n  // If we get here, it means that neither the \'user\' nor the \'book\' are inserted.\n  console.log(error);\n  abort(400, "cannot insert into the database");\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/transactions.html"},"Knex's transaction documentation")," for more details.")))}p.isMDXComponent=!0}}]);